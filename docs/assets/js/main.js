const searchInput=document.querySelector(".js-search"),btn=document.querySelector(".js-btn"),resultsContainer=document.querySelector(".js-results-container");let searchedShows=[];const handleSearch=()=>{""===searchInput.value?handleEmptySearch():getDataFromApi()},getDataFromApi=()=>{const e=searchInput.value;fetch("//api.tvmaze.com/search/shows?q= + "+e).then(e=>e.json()).then((function(e){0===Object.entries(e).length?handleNotFound():(searchedShows=e,paintShows(),listenShows(),listenFavs())})).catch(e=>handleServerError(e))},createParagraph=e=>{const t=document.createElement("p");resultsContainer.appendChild(t),t.appendChild(e),t.classList.add("error-message")},handleNotFound=()=>{const e=document.createTextNode("Oops, that show is not on our database. Try again!");createParagraph(e)},handleServerError=e=>{console.log("Sorry, an unexpected error has ocurred:",e);const t=document.createTextNode("Server error: I'm sorry, please try again later.");createParagraph(t)},handleEmptySearch=()=>{const e=document.createTextNode("First you need to write the name of a TV show :)");createParagraph(e)};btn.addEventListener("click",handleSearch);const showsContainer=document.querySelector(".js-shows-container"),wrapperEl=document.querySelector(".page-wrapper"),paintShows=()=>{let e="";for(let t=0;t<searchedShows.length;t++){const s=searchedShows[t].show.name;if(e+=`<li class="shows-list__item js-show-item" data-id="${searchedShows[t].show.id}">`,null!=searchedShows[t].show.image){e+=`<img src="${searchedShows[t].show.image.original}" alt="Imagen de la serie ${s}" class="shows-list__img" title="Imagen de la serie ${s}"></img>`}else imgURL="./assets/images/nopicture.png",e+=`<img src="${imgURL}" alt="Imagen de la serie ${s}" class="shows-list__img">`;e+=`<h3 class="shows-list__title">${s}</h3>`,e+="</li>",wrapperEl.classList.add("hidden")}showsContainer.innerHTML=e};let favoritedShows=[],favoritedShowsId=[];const selectFavorites=e=>{const t=e.currentTarget,s=parseInt(t.dataset.id);let a={id:s,name:t.querySelector(".shows-list__title").innerHTML,image:t.querySelector(".shows-list__img").src};favoritedShowsId=favoritedShows.map((function(e){return parseInt(e.id)}));const o=favoritedShowsId.indexOf(s);-1===o?(favoritedShows.push(a),t.classList.add("shows-list__item--favorite")):(favoritedShows.splice(o,1),t.classList.remove("shows-list__item--favorite")),paintFavorites(),listenFavs(),setLocalStorage()},listenShows=()=>{const e=document.querySelectorAll(".js-show-item");for(const t of e)t.addEventListener("click",selectFavorites)},favsContainer=document.querySelector(".js-favs-container"),noFavsContainer=document.querySelector(".js-no-favs-container"),handleNoFavs=()=>{const e=document.createElement("p"),t=document.createTextNode("You still don't have anything marked as favorites");noFavsContainer.appendChild(e),e.appendChild(t),e.classList.add("no-favs-message")},paintFavorites=()=>{let e="";for(let t=0;t<favoritedShows.length;t++){const s=favoritedShows[t].name,a=favoritedShows[t].id,o=favoritedShows[t].image;e+='<li class="favorites-list__item">',null!=favoritedShows[t].image?e+=`<img src="${o}" alt="Imagen de la serie ${s}" class="favorites-list__img" title="Imagen de la serie ${s}"></img>`:(o="https://via.placeholder.com/210x295/ffffff/666666/?",htmlShows+=`<img src="${o}" alt="Imagen de la serie ${s}" class="favorites-list__img`),e+=`<h4 class="favorites-list__title">${s}</h4>`,e+=`<input type="button" value="x" class="favorites-list__remove-btn" data-id="${a}">`,e+="</li>"}favsContainer.innerHTML=e,setLocalStorage()},setLocalStorage=()=>{localStorage.setItem("favoritedShows",JSON.stringify(favoritedShows))};function getLocalStorage(){const e=localStorage.getItem("favoritedShows"),t=JSON.parse(e);null!==t?(favoritedShows=t,paintFavorites(),listenShows()):getData()}getLocalStorage();const removeFav=e=>{for(let t=0;t<favoritedShows.length;t++){const s=e.currentTarget;parseInt(s.dataset.id)===parseInt(favoritedShows[t].id)&&favoritedShows.splice([t],1)}paintFavorites(),paintShows(),listenFavs(),listenShows()},listenFavs=()=>{const e=document.querySelectorAll(".favorites-list__remove-btn");for(const t of e)t.addEventListener("click",removeFav)},deleteBtnEl=document.querySelector(".js-delete-btn"),resetFavorites=()=>{favoritedShows=[],localStorage.removeItem("favoritedShows"),paintFavorites(),listenFavs()};deleteBtnEl.addEventListener("click",resetFavorites);